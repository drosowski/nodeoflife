<html>
<head>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
	<script src="http://code.jquery.com/jquery-1.9.0.min.js"></script>
	<style>
		#board {
			float: left;
		}
	</style>
</head>
<body>
	<div id="board"></div>
	
	<div id="settings">
		<div>
			<label for="size">Size of the board</label>
			<input type="text" name="width" id="width" value="32">x
			<input type="text" name="height" id="height" value="32">
		</div>
		<p/>
		<input type="button" onclick="initGrid($('#width').val(), $('#height').val());" value="Resize">

		<p/>
		<div>
			<label for="size">Round time (ms)</label>
			<input type="text" name="time" id="time" value="500">
		</div>
		<p/>
		<input type="button" onclick="startGame($('#time').val());" value="Start">
	</div>

        <script type="text/javascript">

	function startGame(time) {
		var width = $('#width').val(); 
		var height = $('#height').val();

		$.ajax({
			type: "GET",
			url: "startgame",
			data: { width: width, height: height, id: "{{uuid}}" }
		});

		window.setInterval(function() {	
			$.getJSON('population.json?id={{ uuid }}', function(population) {		
				fillGrid(population);	
			});
		}, time);
	};

	function initGrid(width, height) {
		$('#board').html("");
		var grid = Raphael('board', width * 10, height * 10);

		var step = 10;
		for(var i = 0; i < height; i++) {
			for(var j = 0; j < width; j++) {
				var rect = grid.rect(j * step, i * step, step, step);
				rect.attr("stroke-width", 0.1);
			}
		}
	}

	function fillGrid(population) {
		$('#board').html("");
		var grid = Raphael('board', width * 10, height * 10);

		var step = 10;
		for(var i = 0; i < population.length; i++) {
			for(var j = 0; j < population[i].length; j++) {
				var fill = (population[i][j] == 1);
				if(fill) {
					var rect = grid.rect(j * step, i * step, step, step);
					rect.attr("stroke-width", 0.1);
					rect.attr("fill", "black");
				}
				else {
					var rect = grid.rect(j * step, i * step, step, step);
					rect.attr("stroke-width", 0.1);
				}
			}
		}
	}

	$(document).ready(function() {
		initGrid($('#width').val(), $('#height').val());
	});
	</script>
</body>
</html>
